<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- âœ… Reusable address block -->
    <template id="report_invoice_address_block_npi">
        <!-- Title + Name -->
        <div t-if="partner.title or partner.name">
            <t t-if="partner.title">
                <t t-if="partner.title.shortcut">
                    <span t-esc="partner.title.shortcut"/> 
                </t>
                <t t-elif="partner.title.name">
                    <span t-esc="partner.title.name"/> 
                </t>
                <span> </span>
            </t>
            <span t-esc="partner.name"/>
        </div>

        <!-- NPI -->
        <div t-if="partner.npi_number">
            NPI: <span t-esc="partner.npi_number"/>
        </div>

        <!-- Email -->
        <div t-if="partner.email">
            <i class="fa fa-envelope"/> 
            <span t-esc="partner.email"/>
        </div>

        <!-- Company or Parent -->
        <div t-if="partner.company_name or partner.parent_id">
            <span t-esc="partner.company_name or partner.parent_id.name"/>
        </div>

        <!-- Address -->
        <div t-if="partner.street">
            <span t-esc="partner.street"/>
            <t t-if="partner.street2">
                <br/><span t-esc="partner.street2"/>
            </t>
        </div>
        <div t-if="partner.city or partner.state_id or partner.zip">
            <span t-esc="partner.city"/>
            <t t-if="partner.state_id">
                <span> </span><span t-esc="partner.state_id.name"/>
            </t>
            <t t-if="partner.zip">
                <span> </span><span t-esc="partner.zip"/>
            </t>
        </div>
        <div t-if="partner.country_id">
            <span t-esc="partner.country_id.name"/>
        </div>

        <!-- Phone & Mobile -->
        <div t-if="partner.phone">
            <i class="fa fa-phone"/> 
            <span t-esc="partner.phone"/>
        </div>
        <div t-if="partner.mobile">
            <i class="fa fa-mobile"/> 
            <span t-esc="partner.mobile"/>
        </div>

        <!-- VAT -->
        <div t-if="partner.vat">
            VAT: <span t-esc="partner.vat"/>
        </div>
    </template>

    <!-- âœ… Inherit and modify native invoice layout -->
    <template id="report_invoice_npi_native"
              name="Invoice Report with NPI (Native Layout)"
              inherit_id="account.report_invoice_document">

        <!-- Replace the address block -->
        <xpath expr="//div[hasclass('row')]" position="replace">
            <div class="row">

                <!-- ðŸŸ¢ Case 1: Shipping + Billing (different) -->
                <t t-if="o.partner_shipping_id and o.partner_shipping_id != o.partner_id">
                    <div class="col-6">
                        <strong>Shipping Address</strong>
                        <t t-call="ox_partner_npi.report_invoice_address_block_npi">
                            <t t-set="partner" t-value="o.partner_shipping_id"/>
                        </t>
                    </div>

                    <div class="col-6">
                        <strong>Billing Address</strong>
                        <t t-call="ox_partner_npi.report_invoice_address_block_npi">
                            <t t-set="partner" t-value="o.partner_id"/>
                        </t>
                    </div>
                </t>

                <!-- ðŸŸ¢ Case 2: Only Billing -->
                <t t-else="">
                    <div class="offset-col-6 col-6">
                        <strong>Billing Address</strong>
                        <t t-call="ox_partner_npi.report_invoice_address_block_npi">
                            <t t-set="partner" t-value="o.partner_id"/>
                        </t>
                    </div>
                </t>
            </div>
        </xpath>
    </template>

</odoo>
