<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- List View with Grouping Support -->
    <record id="view_commission_tracking_list" model="ir.ui.view">
        <field name="name">commission.tracking.list</field>
        <field name="model">commission.tracking</field>
        <field name="arch" type="xml">
            <list string="Commission Tracking" create="false">
               
                <field name="display_date" string="Date"/>
                <field name="salesperson_id"/>
                <!-- <field name="sale_order_id"/> -->
                <field name="invoice_id"/>
                <field name="customer_id"/>
                <field name="commission_type"/>
                <field name="order_amount" widget="monetary" sum="Total Order Amount"/>
                <field name="commission_percentage" widget="number"/>
                <field name="is_manual_override" widget="boolean_toggle" optional="hide" 
                       invisible="commission_type != 'manager'"/>
                
                <field name="commission_amount" widget="monetary" sum="Total Commission"/>
             
                <field name="invoice_payment_state" widget="badge" 
                       decoration-success="invoice_payment_state == 'paid'"
                       decoration-warning="invoice_payment_state == 'partial'"
                       decoration-danger="invoice_payment_state == 'not_paid'"
                       />
                <field name="vendor_bill_state" widget="badge"/>
                <field name="disbursement_date" widget="string"/>
                <field name="is_paid" widget="boolean_toggle"/>
                <field name="currency_id" invisible="1" column_invisible="1"/>
            </list>
        </field>
    </record>
    
    <!-- Form View (Read-only with Smart Buttons) -->
    <record id="view_commission_tracking_form" model="ir.ui.view">
        <field name="name">commission.tracking.form</field>
        <field name="model">commission.tracking</field>
        <field name="arch" type="xml">
            <form string="Commission Tracking" create="false" delete="false">
                <header>
                    <button name="action_open_vendor_bill" type="object" string="Vendor Bill"
                             icon="fa-briefcase" class="oe_stat_button"
                            invisible="not vendor_bill_id"/>
                    <button name="action_open_customer_invoice" type="object" string="Customer Invoice"
                            icon="fa-file-text-o" class="oe_stat_button"
                            invisible="not invoice_id"/>
                    <button name="action_open_sale_order" type="object" string="Sales Order"
                            icon="fa-shopping-cart" class="oe_stat_button"
                            invisible="not sale_order_id"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="sale_order_id" readonly="1"/>
                            <field name="salesperson_id" readonly="1"/>
                            <field name="customer_id" readonly="1"/>
                            <field name="commission_plan_id" readonly="1"/>
                            <field name="disbursement_frequency" readonly="1"/>
                        </group>
                        <group>
                            <field name="order_amount" readonly="1"/>
                            <field name="commission_type" readonly="1"/>
                            <field name="commission_percentage" 
                                   readonly="commission_type != 'manager' or vendor_bill_id"
                                   required="commission_type == 'manager'"
                                   help="For manager commissions, you can manually adjust this percentage. Once a vendor bill is created, it cannot be changed."/>
                            <field name="is_manual_override" 
                                   readonly="commission_type != 'manager' or vendor_bill_id"
                                   invisible="commission_type != 'manager'"
                                   help="Automatically set to True when commission percentage is manually adjusted"/>
                            <field name="commission_amount" readonly="1"/>
                            <field name="currency_id" readonly="1"/>
                        </group>
                    </group>
                    <group>
                        <group>
                            <field name="invoice_id" readonly="1" />
                            <field name="invoice_payment_state" widget="badge"
                            decoration-success="invoice_payment_state == 'paid'"
                       decoration-warning="invoice_payment_state == 'partial'"
                       decoration-danger="invoice_payment_state == 'not_paid'"
                             readonly="1"/>
                        </group>
                        <group>
                            <field name="vendor_bill_id" readonly="1"/>
                            <field name="vendor_bill_state" widget="badge"
                            decoration-success="vendor_bill_state == 'posted'"
                       decoration-warning="vendor_bill_state == 'draft'"
                       decoration-danger="vendor_bill_state == 'cancel'"
                            readonly="1"/>
                        </group>
                    </group>
                    <group>
                        <group>
                            <field name="disbursement_date" readonly="1"/>
                            <field name="is_paid" widget="boolean_toggle"
                            decoration-success="is_paid == True"
                       decoration-danger="is_paid == False"
                            readonly="1"/>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>
    
    <!-- Search View with Grouping -->
    <record id="view_commission_tracking_search" model="ir.ui.view">
        <field name="name">commission.tracking.search</field>
        <field name="model">commission.tracking</field>
        <field name="arch" type="xml">
            <search string="Commission Search">
                <field name="salesperson_id"/>
                <field name="customer_id"/>
                <field name="sale_order_id"/>
                <field name="invoice_id"/>
         
                <field name="currency_id" invisible="1"/>
                <filter string="Invoice Paid" name="invoice_paid" 
                        domain="[('invoice_payment_state', '=', 'paid')]"/>
                <separator/>
                <filter string="Admin Commission" name="admin_commission" 
                        domain="[('commission_type', '=', 'admin')]"/>
                <filter string="First Order" name="first_order" 
                        domain="[('commission_type', '=', 'first_order')]"/>
                <filter string="Residual" name="residual" 
                        domain="[('commission_type', '=', 'residual')]"/>
                <filter string="Manager Commission" name="manager_commission" 
                        domain="[('commission_type', '=', 'manager')]"/>
                <separator/>
                <filter string="Paid" name="paid" domain="[('is_paid', '=', True)]"/>
                <filter string="Unpaid" name="unpaid" domain="[('is_paid', '=', False)]"/>
                
                <group expand="0" string="Group By">
                    <filter string="Commission User" name="group_salesperson" 
                            context="{'group_by': 'salesperson_id'}"/>
                    <filter string="Disbursement Frequency" name="group_frequency" 
                            context="{'group_by': 'disbursement_frequency'}"/>
                    <filter string="Commission Type" name="group_type" 
                            context="{'group_by': 'commission_type'}"/>

                    <filter string="Invoice Paid Status" name="group_invoice_payment" 
                            context="{'group_by': 'invoice_payment_state'}"/>
                    <separator/>
                    <filter string="Is Paid" name="group_is_paid" 
                            context="{'group_by': 'is_paid'}"/>
                   
                </group>
            </search>
        </field>
    </record>
</odoo>